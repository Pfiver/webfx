<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>naga-platforms</artifactId>
        <groupId>naga</groupId>
        <version>0.1.0-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>naga-platform-teavm</artifactId>

    <dependencies>

        <dependency>
            <artifactId>naga-abstractplatform-web</artifactId>
            <groupId>${naga.groupId}</groupId>
            <version>${naga.version}</version>
        </dependency>

        <dependency>
            <artifactId>naga-javaemul-teavm</artifactId>
            <groupId>${naga.groupId}</groupId>
            <version>${naga.version}</version>
        </dependency>

        <dependency>
            <artifactId>naga-javaemul-javatime</artifactId>
            <groupId>${naga.groupId}</groupId>
            <version>${naga.version}</version>
        </dependency>

        <!-- Emulator of Java class library for TeaVM -->
        <dependency>
            <groupId>org.teavm</groupId>
            <artifactId>teavm-classlib</artifactId>
        </dependency>

        <!-- JavaScriptObjects (JSO) - a JavaScript binding for TeaVM -->
        <dependency>
            <groupId>org.teavm</groupId>
            <artifactId>teavm-jso</artifactId>
        </dependency>

    </dependencies>

    <properties>
        <!-- Disabling the default behaviour defined in the parent pom for the shade plugin -->
        <plugin.shade.param.fat.phase>none</plugin.shade.param.fat.phase>
    </properties>

    <build>
        <plugins>

            <!-- Relocating the java_cup package to avoid a version conflict that makes TeaVM compilation fail (TeaVM has a dependency on xalan which includes an incompatible version of java_cup) -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-shade-plugin</artifactId>
                <executions>
                    <execution>
                        <phase>package</phase>
                        <goals>
                            <goal>shade</goal>
                        </goals>
                        <configuration>
                            <shadedArtifactAttached>false</shadedArtifactAttached>
                            <createSourcesJar>true</createSourcesJar>
                            <createDependencyReducedPom>false</createDependencyReducedPom>
                            <relocations>
                                <!-- 1) TeaVM has a dependency on xalan that uses an incompatible version of java_cup
                                        so we relocate our version to avoid a compilation error -->
                                <relocation>
                                    <pattern>java_cup</pattern>
                                    <shadedPattern>java_cub_11b</shadedPattern>
                                </relocation>

                                <!-- 2) Relocating java emulated classes from naga-javaemul-teavm and naga-javaemul-shared
                                        under org.teavm.classlib and prefix them with a T -->

                                <!-- Emulated java classes required for naga-core TeaVM compilation -->
                                <relocation>
                                    <pattern>java.util.Base64</pattern>
                                    <shadedPattern>org.teavm.classlib.java.util.TBase64</shadedPattern>
                                </relocation>

                                <!-- Emulated java classes required for java_cup TeaVM compilation -->
                                <relocation>
                                    <pattern>java.util.Stack</pattern>
                                    <shadedPattern>org.teavm.classlib.java.util.TStack</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.util.EmptyStackException</pattern>
                                    <shadedPattern>org.teavm.classlib.java.util.TEmptyStackException</shadedPattern>
                                </relocation>

                                <!-- Emulated java classes required for naga-javalib-rxjava TeaVM compilation -->
                                <relocation>
                                    <pattern>java.util.concurrent.atomic.AtomicReference</pattern>
                                    <shadedPattern>org.teavm.classlib.java.util.concurrent.atomic.TAtomicReference</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.util.concurrent.atomic.AtomicReferenceArray</pattern>
                                    <shadedPattern>org.teavm.classlib.java.util.concurrent.atomic.TAtomicReferenceArray</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.util.concurrent.atomic.AtomicInteger</pattern>
                                    <shadedPattern>org.teavm.classlib.java.util.concurrent.atomic.TAtomicInteger</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.util.concurrent.atomic.AtomicLong</pattern>
                                    <shadedPattern>org.teavm.classlib.java.util.concurrent.atomic.TAtomicLong</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.util.concurrent.TimeUnit</pattern>
                                    <shadedPattern>org.teavm.classlib.java.util.concurrent.TTimeUnit</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.lang.StackOverflowError</pattern>
                                    <shadedPattern>org.teavm.classlib.java.lang.TStackOverflowError</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.lang.ThreadDeath</pattern>
                                    <shadedPattern>org.teavm.classlib.java.lang.TThreadDeath</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.lang.LinkageError</pattern>
                                    <shadedPattern>org.teavm.classlib.java.lang.TLinkageError</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.Clock</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TClock</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.DateTimeException</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TDateTimeException</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.DayOfWeek</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TDayOfWeek</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.Duration</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TDuration</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.Instant</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TInstant</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.LocalDate</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TLocalDate</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.LocalTime</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TLocalTime</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.Month</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TMonth</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.MonthDay</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TMonthDay</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.OffsetDate</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TOffsetDate</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.OffsetDateTime</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TOffsetDateTime</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.OffsetTime</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TOffsetTime</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.Period</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TPeriod</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.PeriodParser</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TPeriodParser</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.Year</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TYear</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.YearMonth</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TYearMonth</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.ZonedDateTime</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TZonedDateTime</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.ZoneId</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TZoneId</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.ZoneOffset</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.TZoneOffset</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.ChronoField</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TChronoField</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.ChronoUnit</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TChronoUnit</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.DateTime</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TDateTime</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.DateTimeAccessor</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TDateTimeAccessor</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.DateTimeAdjusters</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TDateTimeAdjusters</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.DateTimeBuilder</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TDateTimeBuilder</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.DateTimeField</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TDateTimeField</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.DateTimeValueRange</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TDateTimeValueRange</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.ISOWeeks</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TISOWeeks</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.JulianDayField</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TJulianDayField</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.PeriodUnit</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TPeriodUnit</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.calendrical.WeekDefinition</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.calendrical.TWeekDefinition</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.chrono.Chrono</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TChrono</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.chrono.ChronoDateTimeImpl</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TChronoDateTimeImpl</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.chrono.ChronoLocalDate</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TChronoLocalDate</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.chrono.ChronoLocalDateTime</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TChronoLocalDateTime</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.chrono.ChronoZonedDateTime</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TChronoZonedDateTime</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.chrono.ChronoZonedDateTimeImpl</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TChronoZonedDateTimeImpl</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.chrono.Era</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TEra</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.chrono.ISOChrono</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TISOChrono</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.chrono.ISOEra</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TISOEra</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.format.DateTimeParseException</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TDateTimeParseException</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.format.FormatStyle</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TFormatStyle</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.format.SignStyle</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TSignStyle</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.format.TextStyle</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.chrono.TTextStyle</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.jdk8.DefaultInterfaceChronoLocalDate</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.jdk8.TDefaultInterfaceChronoLocalDate</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.jdk8.DefaultInterfaceChronoLocalDateTime</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.jdk8.TDefaultInterfaceChronoLocalDateTime</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.jdk8.DefaultInterfaceChronoZonedDateTime</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.jdk8.TDefaultInterfaceChronoZonedDateTime</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.jdk8.DefaultInterfaceDateTime</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.jdk8.TDefaultInterfaceDateTime</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.jdk8.DefaultInterfaceDateTimeAccessor</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.jdk8.TDefaultInterfaceDateTimeAccessor</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.jdk8.Jdk7Methods</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.jdk8.TJdk7Methods</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.jdk8.Jdk8Methods</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.jdk8.TJdk8Methods</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>java.time.zone.ZoneRules</pattern>
                                    <shadedPattern>org.teavm.classlib.java.time.zone.TZoneRules</shadedPattern>
                                </relocation>
                            </relocations>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

        </plugins>

    </build>

</project>